<tool name="POGs" id="POGs" version="2.0">

	<description>
		Find orthologous groups
	</description>

	<macros>
		<import>macros.xml</import>
	</macros>

	<requirements>
		<expand macro="python_required" />
	</requirements>

  	<command>
	<![CDATA[
        #set $infiles_from_paiwise_prot = ""
        #for $input_from_paiwise_prot in $inputs_from_paiwise_prot
            ln -s '$input_from_paiwise_prot' '$input_from_paiwise_prot.element_identifier';
            #set $infiles_from_paiwise_prot = $infiles_from_paiwise_prot + $input_from_paiwise_prot.element_identifier + ","
        #end for
        #set $infiles_from_paiwise_prot = $infiles_from_paiwise_prot[:-1]

		python '$__tool_directory__/scripts/pogs.py' '$infiles_from_paiwise_prot' $minseq > ${log}

	]]>
  	</command>

 	<inputs>
        <param name="inputs_from_paiwise_prot" type="data" format="fasta" multiple="true" label="Input files from Pairwise Prot" />
		<param name="minseq" type="integer" value="3" label="Drop orthogroups with less than n species" />		
	</inputs>

	<outputs>
		<data format="txt" name="log" label="POGs" />
        <collection name="output" type="list" label="POGs locus orthologs unaligned">
            <discover_datasets pattern="__name_and_ext__" directory="outputs" />
        </collection>
	</outputs>

	<tests>
		<test>
            <param name="inputs_from_paiwise_prot" ftype="fasta" value="output_paiwise/RBH_AmAmphi_AcAcaud.fasta,output_paiwise/RBH_ApApomp_AcAcaud.fasta,output_paiwise/RBH_ApApomp_AmAmphi.fasta,output_paiwise/RBH_ThThelep_AcAcaud.fasta,output_paiwise/RBH_ThThelep_AmAmphi.fasta,output_paiwise/RBH_ThThelep_ApApomp.fasta" />
			<param name="minseq" value="4" />			
			<output name="log" value="pogs.output" />
            <output_collection name="output" type="list">
                <element name="locus1_sp2" value="outputs/orthogroup_1_with_5_sequences.fasta" />
                <element name="locus1_sp3" value="outputs/orthogroup_2_with_8_sequences.fasta" />
                <element name="locus2_sp2" value="outputs/orthogroup_3_with_4_sequences.fasta" />
                <element name="locus3_sp2" value="outputs/orthogroup_4_with_8_sequences.fasta" />
                <element name="locus4_sp2" value="outputs/orthogroup_5_with_4_sequences.fasta" />
                <element name="locus5_sp2" value="outputs/orthogroup_6_with_6_sequences.fasta" />
                <element name="locus6_sp2" value="outputs/orthogroup_7_with_6_sequences.fasta" />
                <element name="locus7_sp2" value="outputs/orthogroup_8_with_4_sequences.fasta" />
                <element name="locus8_sp2" value="outputs/orthogroup_10_with_6_sequences.fasta" />
                <element name="locus9_sp2" value="outputs/orthogroup_11_with_4_sequences.fasta" />                
            </output_collection>
		</test>
	</tests>	

	<help>

@HELP_AUTHORS@

============
What it does
============

| This tool parses homologous sequences obtained by pairwise and gather sequences into groups of orthologous sequences.

--------

======
Inputs
======
| A dataset collection with the the pairwise with the homologous sequences (obtained from the tool "Pairwise").

--------

=======
Outputs
=======

This tool, produces the following files :

**POGs** :

| is the general output. It gives the number of sequences at each filtering step and then count
| the number of groups.

**POGs_locus_orthologs_unaligned** :

| is the output which contains the groups of orthologous sequences,
| one file corresponding to one group.

the sequences of each group are in nucleic format.

Changelog
---------

**Version 2.1 - 04/01/2018**

  - Rewritten with improved results and better code

**Version 2.0 - 11/07/2017**

 - Replace the zip between tools by Dataset Collection
 - Add option : paralogs filtering
 - Added a second functional test (to test the new option)
 - Code factoring
 - Removed zip format of input and output files ; replaced by dataset collections


**Version 1.0 - 13/04/2017**

 - TEST: Add funtional test with planemo
 - IMPROVEMENT: Use conda dependencies for python

	</help>

	<expand macro="citations" />

</tool>
